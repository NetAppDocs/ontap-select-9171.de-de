---
sidebar: sidebar 
permalink: concept_nw_vsphere_vswitch_config.html 
keywords: ontap select, standard and distributed vSwitch configurations, vSwitch configuration and load-balancing policies 
summary: ONTAP Select vSwitch-Konfiguration und Lastausgleichsrichtlinien für Konfigurationen mit zwei und vier NICs. 
---
= ONTAP Select die VMware vSphere vSwitch-Konfiguration auf ESXi aus
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ONTAP Select vSwitch-Konfiguration und Lastausgleichsrichtlinien für Konfigurationen mit zwei und vier NICs.

ONTAP Select unterstützt sowohl Standard- als auch Distributed-vSwitch-Konfigurationen. Distributed-vSwitches unterstützen Link Aggregation Konstrukte (LACP). Link Aggregation ist ein gängiges Netzwerkkonstrukt, mit dem Bandbreite über mehrere physische Adapter hinweg aggregiert wird. LACP ist ein herstellerneutraler Standard, der ein offenes Protokoll für Netzwerkendpunkte bereitstellt, das Gruppen physischer Netzwerkports in einem einzigen logischen Kanal bündelt. ONTAP Select kann mit Portgruppen arbeiten, die als Link Aggregation Group (LAG) konfiguriert sind. NetApp empfiehlt jedoch, die einzelnen physischen Ports als einfache Uplink-Ports (Trunk-Ports) zu verwenden, um die LAG-Konfiguration zu vermeiden. In diesen Fällen sind die Best Practices für Standard- und Distributed-vSwitches identisch.

In diesem Abschnitt werden die vSwitch-Konfiguration und die Lastausgleichsrichtlinien beschrieben, die sowohl in Konfigurationen mit zwei als auch mit vier NICs verwendet werden sollten.

Beim Konfigurieren der von ONTAP Select zu verwendenden Portgruppen sollten die folgenden Best Practices befolgt werden: Die Lastausgleichsrichtlinie auf Portgruppenebene lautet „Route basierend auf der ID des ursprünglichen virtuellen Ports“. VMware empfiehlt, STP auf den mit den ESXi-Hosts verbundenen Switch-Ports auf Portfast einzustellen.

Alle vSwitch-Konfigurationen erfordern mindestens zwei physische Netzwerkadapter, die in einem NIC-Team gebündelt sind. ONTAP Select unterstützt eine einzelne 10-Gbit-Verbindung für Cluster mit zwei Knoten. Es ist jedoch eine bewährte NetApp Praxis, die Hardwareredundanz durch NIC-Aggregation sicherzustellen.

Auf einem vSphere-Server sind NIC-Teams die Aggregationsstruktur, mit der mehrere physische Netzwerkadapter in einem einzigen logischen Kanal gebündelt werden. Dadurch kann die Netzwerklast auf alle angeschlossenen Ports verteilt werden. Wichtig ist, dass NIC-Teams auch ohne Unterstützung des physischen Switches erstellt werden können. Lastausgleichs- und Failover-Richtlinien können direkt auf ein NIC-Team angewendet werden, ohne die Konfiguration des Upstream-Switches zu kennen. In diesem Fall werden die Richtlinien nur auf ausgehenden Datenverkehr angewendet.


NOTE: Statische Portkanäle werden von ONTAP Select nicht unterstützt. LACP-fähige Kanäle werden von verteilten vSwitches unterstützt, die Verwendung von LACP-LAGs kann jedoch zu einer ungleichmäßigen Lastverteilung auf die LAG-Mitglieder führen.

Bei Einzelknotenclustern konfiguriert ONTAP Deploy die ONTAP Select VM so, dass eine Portgruppe für das externe Netzwerk und entweder dieselbe oder optional eine andere Portgruppe für den Cluster- und Knotenverwaltungsverkehr verwendet wird. Bei Einzelknotenclustern kann die gewünschte Anzahl physischer Ports als aktive Adapter zur externen Portgruppe hinzugefügt werden.

Bei Multinode-Clustern konfiguriert ONTAP Deploy jede ONTAP Select VM so, dass sie eine oder zwei Portgruppen für das interne Netzwerk und separat eine oder zwei Portgruppen für das externe Netzwerk verwendet. Der Cluster- und Knotenverwaltungsverkehr kann entweder dieselbe Portgruppe wie der externe Verkehr oder optional eine separate Portgruppe verwenden. Der Cluster- und Knotenverwaltungsverkehr kann nicht dieselbe Portgruppe wie der interne Verkehr verwenden.


NOTE: ONTAP Select unterstützt maximal vier VMNICs.



== Standard- oder verteilter vSwitch und vier physische Ports pro Knoten

Jedem Knoten in einem Multiknotencluster können vier Portgruppen zugewiesen werden. Jede Portgruppe verfügt über einen aktiven physischen Port und drei physische Standby-Ports (siehe folgende Abbildung).

*vSwitch mit vier physischen Ports pro Knoten*

image:DDN_08.jpg["vSwitch mit vier physischen Ports pro Knoten"]

Die Reihenfolge der Ports in der Standby-Liste ist wichtig. Die folgende Tabelle zeigt ein Beispiel für die physische Portverteilung auf die vier Portgruppen.

*Mindest- und empfohlene Netzwerkkonfigurationen*

[cols="5*"]
|===
| Portgruppe | Extern 1 | Extern 2 | Intern 1 | Intern 2 


| Aktiv | vmnic0 | vmnic1 | vmnic2 | vmnic3 


| Standby 1 | vmnic1 | vmnic0 | vmnic3 | vmnic2 


| Standby 2 | vmnic2 | vmnic3 | vmnic0 | vmnic1 


| Standby 3 | vmnic3 | vmnic2 | vmnic1 | vmnic0 
|===
Die folgenden Abbildungen zeigen die Konfigurationen der externen Netzwerk-Portgruppen aus der vCenter-UI (ONTAP-External und ONTAP-External2). Beachten Sie, dass die aktiven Adapter von unterschiedlichen Netzwerkkarten stammen. In diesem Setup sind vmnic 4 und vmnic 5 Dual-Ports auf derselben physischen Netzwerkkarte, während vmnic 6 und vminc 7 ebenfalls Dual-Ports auf einer separaten Netzwerkkarte sind (vnmics 0 bis 3 werden in diesem Beispiel nicht verwendet). Die Reihenfolge der Standby-Adapter ermöglicht ein hierarchisches Failover, wobei die Ports des internen Netzwerks zuletzt kommen. Die Reihenfolge der internen Ports in der Standby-Liste ist zwischen den beiden externen Portgruppen ebenfalls vertauscht.

*Teil 1: ONTAP Select externe Portgruppenkonfigurationen*

image:DDN_09.jpg["Teil 1: ONTAP Select externe Portgruppenkonfigurationen"]

*Teil 2: ONTAP Select externe Portgruppenkonfigurationen*

image:DDN_10.jpg["Teil 2: ONTAP Select externe Portgruppenkonfigurationen"]

Zur besseren Lesbarkeit lauten die Zuordnungen wie folgt:

[cols="2*"]
|===
| ONTAP– Extern | ONTAP– Extern2 


| Aktive Adapter: vmnic5 Standby-Adapter: vmnic7, vmnic4, vmnic6 | Aktive Adapter: vmnic7 Standby-Adapter: vmnic5, vmnic6, vmnic4 
|===
Die folgenden Abbildungen zeigen die Konfigurationen der internen Netzwerk-Portgruppen (ONTAP-Internal und ONTAP-Internal2). Beachten Sie, dass die aktiven Adapter von unterschiedlichen Netzwerkkarten stammen. In diesem Setup sind vmnic 4 und vmnic 5 Dual-Ports auf demselben physischen ASIC, während vmnic 6 und vmnic 7 ebenfalls Dual-Ports auf einem separaten ASIC sind. Die Reihenfolge der Standby-Adapter ermöglicht ein hierarchisches Failover, wobei die Ports des externen Netzwerks zuletzt anstehen. Die Reihenfolge der externen Ports in der Standby-Liste ist zwischen den beiden internen Portgruppen ebenfalls vertauscht.

*Teil 1: ONTAP Select interne Portgruppenkonfigurationen*

image:DDN_11.jpg["Teil 1: ONTAP Select interne Portgruppenkonfigurationen"]

*Teil 2: ONTAP Select interne Portgruppen*

image:DDN_12.jpg["Teil 2: ONTAP Select"]

Zur besseren Lesbarkeit lauten die Zuordnungen wie folgt:

[cols="2*"]
|===
| ONTAP– Intern | ONTAP– Intern2 


| Aktive Adapter: vmnic4 Standby-Adapter: vmnic6, vmnic5, vmnic7 | Aktive Adapter: vmnic6 Standby-Adapter: vmnic4, vmnic7, vmnic5 
|===


== Standard- oder verteilter vSwitch und zwei physische Ports pro Knoten

Bei Verwendung von zwei Hochgeschwindigkeits-Netzwerkkarten (25/40 Gbit) ähnelt die empfohlene Portgruppenkonfiguration konzeptionell stark der Konfiguration mit vier 10-Gbit-Adaptern. Auch bei Verwendung von nur zwei physischen Adaptern sollten vier Portgruppen verwendet werden. Die Portgruppenzuweisungen lauten wie folgt:

[cols="5*"]
|===
| Portgruppe | Extern 1 (e0a,e0b) | Intern 1 (e0c,e0e) | Intern 2 (e0d,e0f) | Extern 2 (e0g) 


| Aktiv | vmnic0 | vmnic0 | vmnic1 | vmnic1 


| Stehen zu | vmnic1 | vmnic1 | vmnic0 | vmnic0 
|===
*vSwitch mit zwei physischen Hochgeschwindigkeitsports (25/40 Gb) pro Knoten*

image:DDN_17.jpg["vSwitch mit zwei physischen Hochgeschwindigkeitsports (25/40 Gb) pro Knoten"]

Bei Verwendung von zwei physischen Ports (10 GB oder weniger) sollte jede Portgruppe über einen aktiven Adapter und einen Standby-Adapter verfügen, die einander gegenüberliegend konfiguriert sind. Das interne Netzwerk ist nur für ONTAP Select Cluster mit mehreren Knoten vorhanden. Für Cluster mit einem Knoten können beide Adapter in der externen Portgruppe als aktiv konfiguriert werden.

Das folgende Beispiel zeigt die Konfiguration eines vSwitch und der beiden Portgruppen, die für die interne und externe Kommunikation eines ONTAP Select Clusters mit mehreren Knoten zuständig sind. Das externe Netzwerk kann bei einem Netzwerkausfall die interne VMNIC nutzen, da die internen VMNICs Teil dieser Portgruppe sind und im Standby-Modus konfiguriert sind. Für das externe Netzwerk ist es umgekehrt. Der Wechsel der aktiven und Standby-VMNICs zwischen den beiden Portgruppen ist entscheidend für das ordnungsgemäße Failover der ONTAP Select VMs bei Netzwerkausfällen.

*vSwitch mit zwei physischen Ports (10 GB oder weniger) pro Knoten*

image:DDN_13.jpg["vSwitch mit zwei physischen Ports pro Knoten"]



== Verteilter vSwitch mit LACP

Bei der Verwendung verteilter vSwitches in Ihrer Konfiguration kann LACP zur Vereinfachung der Netzwerkkonfiguration eingesetzt werden (obwohl dies keine Best Practice ist). Die einzige unterstützte LACP-Konfiguration erfordert, dass sich alle VMNICs in einer einzigen LAG befinden. Der physische Uplink-Switch muss eine MTU-Größe zwischen 7.500 und 9.000 auf allen Ports im Kanal unterstützen. Die internen und externen ONTAP Select Netzwerke sollten auf Portgruppenebene isoliert sein. Das interne Netzwerk sollte ein nicht routingfähiges (isoliertes) VLAN verwenden. Das externe Netzwerk kann entweder VST, EST oder VGT verwenden.

Die folgenden Beispiele zeigen die verteilte vSwitch-Konfiguration mit LACP.

*LAG-Eigenschaften bei Verwendung von LACP*

image:DDN_14.jpg["LAG-Eigenschaften bei Verwendung von LACP"]

*Externe Portgruppenkonfigurationen mithilfe eines verteilten vSwitch mit aktiviertem LACP*

image:DDN_15.jpg["Externe Portgruppenkonfigurationen mithilfe eines verteilten vSwitch mit aktiviertem LACP"]

*Interne Portgruppenkonfigurationen mithilfe eines verteilten vSwitch mit aktiviertem LACP*

image:DDN_16.jpg["Interne Portgruppenkonfigurationen mithilfe eines verteilten vSwitch mit aktiviertem LACP"]


NOTE: LACP erfordert die Konfiguration der Upstream-Switch-Ports als Port-Kanal. Stellen Sie vor der Aktivierung auf dem verteilten vSwitch sicher, dass ein LACP-fähiger Port-Kanal ordnungsgemäß konfiguriert ist.
